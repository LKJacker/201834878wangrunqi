from sinclair duncan sinclair subject glasgow rx remote execution of x program i post thi a few week back but all i get back wa an error message pnews permission deny yep have a mode of arrghhh with renew interest in set the display variable etc i think i would post my contribution thi perl script be my solution it try to be intelligent about what it do so that you should be able to type rx and get a xterm run on with all the difficult stuff take care of in theory thi program can do everything you ever want to do when you want to run a remote command in the background it do even need to be an x program try a rx big-machine make for instance for a background make on the remote big-machine for more detail and a full list of feature read the readme file about line below all comment welcome duncan thi be a shell archive remove anything before thi line then unpack it by save it into a file and type sh file to overwrite exist file type sh file c you can also fee thi a standard input vium unshar or by type sh file if thi archive be complete you will see the follow message at the end end of archive of content readme imakefile manifest makefile wrapped by sinclair on thu apr export path if test f a c then echo shar will not clobber exist file else echo shar extracting character sed x x glasgow rx remote execution of x program version x xcopyright duncan sinclair sinclair x xtrivial to install but there an imakefile to make it even more trivial x xthe perl script need some customisation before it be instal just xedit the file and read the comment once you do xthi you can xmkmf then make install x xfeature x x do the right thing for off-site remote execution including x set up display to include domain name and pass x magic cookie or do the xhost stuff x x allow different remote user name rx l user host x x smart quote of argument make pass wild-card easy x x custom command execution link it to remac to get a remote x emac command x x automatic xterm option name the xterm accord to hostname x and turn on login shell x x default command be xterm x x propagate x-ish env variable to remote session user may x extend the list of variable to pa x x special handle for bourne shell user x x try to do remote execution from same directory a local x that be it propagate pwd in an intelligent manner x x log error in a file x x overall intelligence tm make reason decision about what x you be try to do and try to do the right thing x x written in perl for portability and hackability x xfor more info read the man page or the source x if test ne wc c then echo shar unpack with wrong size fi end of fi if test f a c then echo shar will not clobber exist file else echo shar extracting character sed x glasgow rx imakefile x x program rx x xall program x xinstall safe x xinstallnamedprog rx bindir xinstallmanpage rx mandir x xinstall x rm bindir rxterm x ln bindir rx bindir rxterm x xsafe x grep s false x xshar safe x makekit m p x perl pu e part x if test ne wc c then echo shar unpack with wrong size fi end of fi if test f a c then echo shar will not clobber exist file else echo shar extracting character sed x file name archive description x x readme read me first x imakefile x manifest thi ship list x makefile x x if test ne wc c then echo shar unpack with wrong size fi end of fi if test f a c then echo shar will not clobber exist file else echo shar extracting character sed x makefile generate by imake do not edit x xconsortium v rw exp x x the cpp use on thi machine replace all newline and multiple tab and x space in a macro expansion with a single space imake try to compensate x for thi but be not alway successful x x x x makefile generate from and x xconsortium v rw exp x x platform-specific parameter may be set in the appropriate vendor cf x configuration file site-specific parameter should be set in the file x full rebuild be recommend if any parameter be change x x if ymy c preprocessor do not define any unique symbol you will need x to set bootstrapcflag when rebuild imake usually when do x make world the first time x x x x site-specific configuration parameter that need to come before x the platform-specific parameter edit to change x x site xconsortium v rw exp x x x platform-specific configuration parameter edit to change x x platform xconsortium v rw exp x x operate system suno x x xconsortium v rw exp x x x site-specific configuration parameter that go after x the platform-specific parameter edit to change x x site xconsortium v rw exp x x shell x x top x x x ar ar cq x bootstrapcflag x cc gcc fpcc-struct-return x a a x x compres compres x cpp x preprocesscmd gcc fpcc-struct-return e x install install x ld ld x lint lint x lintlibflag c x lintopt axz x ln ln s x make make x mv mv x cp cp x x ranlib ranlib x ranlibinstflag x x rm rm f x troff psroff x msmacro m x tbl tbl x eqn eqn x x x x x x tag ctag x x sharedcodedef dsharedcode x shlibdef dsunshlib x x x x instpgmflag x x instbinflag m x instuidflag m x instlibflag m x instincflag m x instmanflag m x instdatflag m x instkmemflag g kmem m x x projectroot x x i incroot x x cdebugflag x ccoption x x allinclude include x alldefine allinclude define x cflag cdebugflag ccoption alldefine x lintflag lintopt dlint alldefine x x ldlib x x ldoption cdebugflag ccoption l usrlibdir x x ldcombineflag x r x dependflag x x macrofile x rm ckp ln bak bak o core err a emac tag tag makeout x x x x irulesrc configdir x imake duseinstalled i irulesrc x x iconfigfile irulesrc irulesrc x irulesrc irulesrc x irulesrc macrofile x x x x window system build parameter x xconsortium v rw exp x x x x window system make variable thi need to be coordinate with rule x x pathsep x usrlibdir x bindir x incroot x buildincroot top x buildincdir buildincroot x buildinctop x incdir incroot x admdir x libdir usrlibdir x configdir libdir config x lintlibdir usrlibdir lint x x fontdir libdir font x xinitdir libdir xinit x xdmdir libdir xdm x twmdir libdir twm x manpath x mansourcepath manpath man x mansuffix n x libmansuffix x mandir mansourcepath mansuffix x libmandir mansourcepath libmansuffix x nlsdir libdir nl x pexapidir libdir pex x xapploaddir libdir app-default x fontcflag t x x instappflag instdatflag x x imake imake x depend makedepend x rgb rgb x x fontc bdftopcf x x mkfontdir mkfontdir x mkdirhier bindir mkdirhier x x configsrc top config x docutilsrc top x clientsrc top client x demosrc top demo x libsrc top lib x fontsrc top font x includesrc top x serversrc top server x utilsrc top util x scriptsrc utilsrc script x examplesrc top example x contribsrc top contrib x docsrc top doc x rgbsrc top rgb x dependsrc utilsrc makedepend x imakesrc configsrc x xauthsrc libsrc xau x xlibsrc libsrc x x xmusrc libsrc xmu x toolkitsrc libsrc xt x awidgetsrc libsrc xaw x oldxlibsrc libsrc oldx x xdmcplibsrc libsrc xdmcp x bdftosnfsrc fontsrc bdftosnf x bdftosnfsrc fontsrc x bdftopcfsrc fontsrc x mkfontdirsrc fontsrc x fslibsrc fontsrc x fontserversrc fontsrc server x extensionsrc top extension x xilibsrc extensionsrc x pexlibsrc extensionsrc x phigslibsrc extensionsrc x x xconsortium v rw exp x xshlibldflag assert pure-text xpicflag fpic x x depextensionlib x extensionlib lxext x x depxlib depextensionlib x xlib extensionlib x x depxmulib usrlibdir soxmurev x xmulibonly lxmu x xmulib lxmu x x depoldxlib x oldxlib loldx x x depxtoollib usrlibdir soxtrev x xtoollib lxt x x depxawlib usrlibdir soxawrev x xawlib lxaw x x depxilib x xilib lxi x x deppexlib x pexlib x x soxlibrev x soxtrev x soxawrev x sooldxrev x soxmurev x soxextrev x soxinputrev x sopexrev x x depxauthlib usrlibdir x xauthlib lxau x depxdmcplib usrlibdir x xdmcplib lxdmcp x x depphigslib usrlibdir x phigslib lphig x x depxbsdlib usrlibdir x xbsdlib lxbsd x x lintextensionlib lintlibdir x lintxlib lintlibdir x lintxmu lintlibdir x lintxtool lintlibdir x lintxaw lintlibdir x lintxi lintlibdir x lintpex lintlibdir x lintphig lintlibdir x x deplib depxawlib depxmulib depxtoollib depxlib x x deplib x deplib x deplib x x x imake rule for build library program script and datum file x rule xconsortium v rw exp x x x start of imakefile x x glasgow rx imakefile x x program rx x xall program x xinstall safe x xinstall x if d destdir bindir then set x x else set x mkdirhier destdir bindir fi x install c instbinflag destdir bindir rx x x if d destdir mandir then set x x else set x mkdirhier destdir mandir fi x install c instmanflag destdir mandir rx mansuffix x xinstall x rm bindir rxterm x ln bindir rx bindir rxterm x xsafe x grep s false x xshar safe x makekit m p x perl pu e part x x x common rule for all makefile do not edit x xemptyrule x xclean x x xmakefile x if f makefile then set x x rm mv makefile x else exit fi x dtopdir top dcurdir x xtag x tag w ch x tag xw ch tag x xsaber x load alldefine src x xosaber x load alldefine obj x x x empty rule for directory that do not have subdir do not edit x xinstall x echo install in do x x echo in do x xmakefile x xinclude x x x dependency generate by makedepend x if test ne wc c then echo shar unpack with wrong size fi end of fi if test f a c then echo shar will not clobber exist file else echo shar extracting character sed rx march x version name xrx rxterm r remote command xterm anything execution synopsi rx x l username x host x command x rxterm x l username x host x arg x description xthe rx xprogram connect to the specify host xand execute the specify command xin the background return immediately to allow the execution xof x program it copy a number of environmental variable to xthe remote session if you omit command xthen rx will start an xterm on the remote host the rxterm xvarient start a remote xterm on a host and also pas arg xto the remote xterm a argument xshell metacharacter which be not quote be interpret on the local xmachine while quote metacharacter be interpret on the remote xmachine xif the name of the file from which rx xi execute be anything other than rx rx xtake thi name strip on a lead r a the command xto run on the remote host use any command xparameter a argument for the remote command xif rx xthink you be use xauth xbased x authorisation and you be call to a off-site host or xto a different username it will attempt to copy an authorization xkey to the remote account otherwise it will try to use xhost xto grant acces to the remote host option l username xuse username xa the remote username instead of ymy local username in the absence xof thi option the remote username be the same a ymy local username x environment xif set the value of path display xenvironment xapplresdir xxfilesearchpath xuserfilesearchpath openwinhome xand xauthority be export to the remote program unles the xremote username be different or the remote host be off-site in which xcase only display be export with in all case any variable name in the xvariable rxenv xthe display variable be tweak a appropriate to contain a qualify xa hostname a be need diagnostic command do recognise my name rx xcannot decode the name it ha be call under in thi case xit print a warn message and continue a normal rx usage rx l username hostname arg xthi mean it could not decode the argument give to it author xduncan sinclair sinclair july xoriginally base on a program with the same name from the gwm xdistribution to distinguish thi rx from other program xwith similar name you should refer to thi program a the glasgow rx see also xx rsh xterm xauth xhost gwm bug rx xmake a number of assumption about the relationship between the xlocal user and the remote one depend on whether the remote xhost be onsite or not and whether an alternative username wa use xor not xin particular if either the locally use shell or the remotely xused shell be the standard bourne shell sh xthen strange thing be more likely to happen especially when xit only one of them xsometime quote can get mess up xit too easy to fool the smart in rx xto make it believe something that be not true and fail because of it xwhen rx xuse xhost xto grant acces the xhost xcommand may fail silently xif rx xtry to send to large a command to the remote machine it will xlikely fail with a parse error from csh if thi happen you xwill probably have to reduce the size of the export environment if test ne wc c then echo shar unpack with wrong size fi end of fi if test f a c then echo shar will not clobber exist file else echo shar extracting character sed x x config change the line above to point to ymy copy of perl x x glasgow rx version x x copyright duncan sinclair sinclair x x last modified early april x x distribution limit a per the usual mit copyright x x remote execution of x program based on a script in an old version of gwm x x to install put rx in ymy bin and make rxterm a link to it x some configuration will be necessary see config comment x x more and more thi be le and le like the original x x major hack to work for my my set up and also partly x re-written to work with sh rather than ksh x x maybe i turn thi into my first zsh script x x look like it turn into a perl script at some point big improvement x x thi code try to be intelligent in the way it work thi mean there x be ton of implicit assumption about the environment it be run in x these assumption be all valid on the machine i use and in my x environment at the same time i try to make a few assumption a possible x about the remote machine here a list of all the more tricky one x that the remote machine ha csh linux x that rshell bin k sh remote shell bin k sh make same x if remote shell sh that path be compatible use csh etc x i pa a cookie to the remote machine if need be but do it x know what to do with a cookie eat it x there must be other x x why be i use csh to run the remote command simply because it do x interact badly with rsh and hang wait for a file descriptor to x be close i rather use zsh or bash or even perl but they be not x a universal a csh x x xrequire x x what we call x x x s x x config x change these variable to be ymy domain name and a pattern that x will match all variation on ymy domain name you must include x those lead dot if ymy hostname include ymy domain see x the code further down mark xxx x x dom x dompat dc gla sgow x x config x change thi to ymy value of bindir or set the variable to if x you think ymy user be smarter than that x x xpath x x config x make thi the name of ymy remote shell command x x rsh rsh x x end of config x x some variable we no doubt use sometime x x usage usage l username hostname arg n x rshell getpwuid x home env home getpwuid x xauth env xauthority home xauthority x logf x stuff x debug x x before anything else close stdin thi might stop rx hang x due to rsh weirdnes x xclose stdin x x do a l flag x xif argv eq l x shift x user argv die usage x luser l user x shift x x x pick a host any host x x mach argv die usage xshift x x thing to think about for the remote machine x x mach s dompat x offsite mach x x where be i seem we ca trust the dumb user to set hostname right x x hostname env hostname hostname current host x hostname hostname current host x hostname x x if all ymy hostname include ymy domain comment out the next line x xif offsite hostname hostname dom xxx x x now we know where we be and they be be they different x x diff hostname ne mach x x what be the display go to be x danger heavy regular expression follow x thi need to be re-written to be modular and can so be extend to x support reset host to unix a require x x display env display x display s dompat x display s unix d d hostname if diff x display s d d dom if offsite x env display display x x here come the hard bite in sh quote my arg x also have to quote quote to cope with csh braindamage x quote be quote thu x so for an arg we get bar x xforeach argv x s g x s x x x so what we do x xprog x if eq rx last prog x if eq rxterm x unshift argv l if diff x unshift argv xterm l n mach x last prog x x if r unshift argv last prog x warn do recognise my name x x x if nothing else become an rxterm x xif argv x unshift argv l if diff x unshift argv xterm l n mach x x x some special consideration if we be not ourself on the other side x xif offsite user x x we want to pa a cookie here x x if e xauth x x thi be go to be unsecure a the cookie will appear in a number x of command line arg but at least it work x thi will need enhance if we ever fix the code above to x set display to when we return to the server x x cookie path path xpath xauth list display x chop cookie x cook split cookie x shift cook x unshift stuff xauth add display cook if cook x else x x yuk what a crock i hate do thi x x system xhost mach if diff x x x we really only want to pa a value for display x x var display split env rxenv x else x x some variable we wish to export x x var x display x xenvironment x xfilesearchpath x xuserfilesearchpath x xapplresdir x openwinhome x x manpath for rxman and bourne shell user x xauthority x split env rxenv x x x braindead bourne shell need to be give a path x we would rather not pa the current path because it might not work x on the destination machine i rather it wa set by the user x remote shell during the rsh x fortunately all my x program be in an arch independant place and x so it should co a problem locally x we check against rshell because they might be run another shell x differant from their login shell i know sound weird but it too x common round here x i also include ksh in the brain-damage co i ca see an easy way x to pa throught env env without it be too late we only have x one person who ha ksh a a login shell anyway x oh yeah we be assume that if it bourne shell here then it x bourne shell there much more important than thi be that it it isnt x bourne shell here it better not be bourne shell there x x if rshell m k sh push var path x x x validate pwd routine x xsub x local pwdstat dotstat x local pwd x x unles define pwd return undef x unles dotstat stat return undef x unles pwdstat stat pwd return undef x if pwdstat dotstat x pwdstat dotstat return undef x pwd x x x try and find a nice valid pwd x xpresent x if pwd env pwd x foopwd pwd x foopwd s x pwd foopwd pwd x x unles pwd x chop pwd pwd x foopwd pwd x foopwd s x pwd foopwd pwd home x x x pwd s x x try to find somewhere nice to live on the other side x xunles offsite x unshift stuff test d pwd cd pwd x x x start build the full command x xforeach var var x val env var x unshift stuff setenv var val x x x some command to do on the other side x xunshift stuff set nonomatch only if we be use csh x x build the remote command x x remote umask join stuff argv logf x remote s g x remote remote x x build the arg list for the exec x x comm rsh luser mach csh fc remote x x do it x xif debug x print x else x exec comm x x x rsh do return any indication of how it go over x on the other side but that ok co we aint go to x wait around to see what happen x xexit x x the end if test ne wc c then echo shar unpack with wrong size fi chmod x end of fi echo shar end of archive of cp missing for i in do if test f ark i isdone then missing missing i fi do if test missing then echo you have the archive rm f ark isdone else echo you still need to unpack the follow archive echo missing fi end of shell archive exit duncan sinclair sinclair sinclair would the real unix operating system please stand up 